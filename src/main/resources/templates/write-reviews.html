<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/layout :: layout(~{::main}, 'Viết đánh giá', ~{::extraHead}, ~{::extraScripts})}">
<head>
    <th:block th:fragment="extraHead">
        <script src="https://cdn.tailwindcss.com"></script>
        <style>body{background:#f5f0e8}</style>
    </th:block>
</head>
<body>
<main class="max-w-3xl mx-auto p-6">
    <h1 class="text-2xl font-semibold mb-4">Viết đánh giá</h1>


    <form th:action="@{|/products/${productId}/reviews|}" method="post" enctype="multipart/form-data"
          th:object="${req}" class="space-y-4 bg-white p-4 rounded shadow">

        <input type="hidden" th:field="*{orderItemId}" th:value="${orderItemId}"/>

        <!-- Rating -->
        <div>
            <label class="block text-sm font-medium mb-1">Đánh giá (1-5 sao)</label>
            <input type="number" min="1" max="5" th:field="*{rating}" class="border rounded px-3 py-2 w-32" required/>
            <p class="text-rose-600 text-sm" th:if="${#fields.hasErrors('rating')}" th:errors="*{rating}"></p>
        </div>

        <!-- Title -->
        <div>
            <label class="block text-sm font-medium mb-1">Tiêu đề</label>
            <input type="text" th:field="*{title}" maxlength="80" class="border rounded px-3 py-2 w-full"
                   placeholder="Ví dụ: Giòn thơm, đóng gói kỹ!"/>
            <p class="text-rose-600 text-sm" th:if="${#fields.hasErrors('title')}" th:errors="*{title}"></p>
        </div>

        <!-- Content -->
        <div>
            <label class="block text-sm font-medium mb-1">Nội dung</label>
            <textarea th:field="*{content}" maxlength="1500" rows="5" class="border rounded px-3 py-2 w-full"
                      placeholder="Chia sẻ về hương vị, độ giòn, giao hàng, đóng gói..."></textarea>
            <p class="text-rose-600 text-sm" th:if="${#fields.hasErrors('content')}" th:errors="*{content}"></p>
        </div>



        <!-- Photos -->
        <div>
            <input type="file" id="photosInput" name="photos" accept="image/*" multiple class="block"/>
        </div>

        <div class="pt-2">
            <button type="submit" class="px-4 py-2 bg-gray-900 text-white rounded hover:opacity-90">Gửi đánh giá</button>
        </div>
    </form>
</main>

<th:block th:fragment="extraScripts">
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const input = document.getElementById("photosInput");

            if (!input) return;

            input.addEventListener("change", function () {
                const files = Array.from(this.files);

                if (files.length > 6) {
                    alert("Bạn chỉ được chọn tối đa 6 ảnh.");
                    this.value = "";
                    return;
                }

                for (const f of files) {
                    if (!f.type.startsWith("image/")) {
                        alert("Chỉ được chọn file hình ảnh (JPG, PNG, JPEG, PNG, WEBP, ...).");
                        this.value = "";
                        return;
                    }
                }
            });
        });
    </script>
</th:block>
</body>
</html>
